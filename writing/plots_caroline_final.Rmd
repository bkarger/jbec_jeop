---
title: "plots_caroline_final"
author: "Caroline Wendt"
date: "12/9/2019"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.path = "../figs/", echo = TRUE,
                      error = FALSE, message = FALSE, warning = FALSE)
```

# Packages
```{r}
# packages for data filtering
library(readr)
library(dplyr)
library(stringr)
library(fuzzyjoin)

# package for tables
library(kableExtra)

# packages for plots
library(ggplot2)
library(viridis)
library(forcats)
library(plotly)
library(ggthemes)
library(RColorBrewer)
```

# Filtering
```{r}
# jeopardy data
jeop_data <- read_tsv(
  file = "../data/jeopardy_clue_dataset-master/master_season1-35.tsv") %>%
  dplyr::mutate(question = stringr::str_to_lower(question)) %>%
  dplyr::mutate(question = stringr::str_remove_all(question,
                                                   "[^[:alnum:][:blank:]]"))
```

```{r}
# subjects and terms data
sub_term_data <- read_csv("../data/subjects_and_terms.csv") %>%
  rename(vocab_term = Term,
      subject = Subject) %>%
  dplyr::mutate(vocab_term = 
                  stringr::str_to_lower(vocab_term)) %>%
  dplyr::mutate(vocab_term = 
                  stringr::str_remove_all(vocab_term,
                                          "[^[:alnum:][:blank:]]")) %>%
  dplyr::distinct() %>% 
  dplyr::mutate(question = vocab_term) %>% 
  dplyr::group_by(subject) %>%
  dplyr::sample_n(size = 155, replace = FALSE) %>% 
  dplyr::ungroup()
```

# Join
```{r}
jeop_school_joined <- dplyr::inner_join(x = jeop_data, y = sub_term_data,
                                        by = "question")
```

# Separate date 
The value framework was different prior to November 26, 2001. The first round value originally ranged from 100 to 500; however, the first round value was doubled to 200 to 1,000 on November 26, 2001.
```{r}
# add column to distinguish whether episode used old or new value framework
jeop_school_joined <- jeop_school_joined %>% 
  dplyr::mutate(air_date_type = if_else(air_date < "2006-11-26", 
                                        "before", "after"))
```

# Summary statistics
```{r}
# before November 26, 2001
jeop_school_summary_before <- jeop_school_joined %>%
  dplyr::filter(air_date_type %in% "before") %>% 
  dplyr::group_by(subject) %>% 
  dplyr::summarize(mean_value = round(mean(value), 2),
                   subject_total = round(n(), 2)) %>% 
  dplyr::ungroup() %>% 
  arrange(desc(subject_total))
```

```{r}
# after November 26, 2001
jeop_school_summary_after <- jeop_school_joined %>%
  dplyr::filter(air_date_type %in% "after") %>% 
  dplyr::group_by(subject) %>% 
  dplyr::summarize(mean_value = round(mean(value), 2),
                   subject_total = round(n(), 2)) %>% 
  dplyr::ungroup() %>% 
  arrange(desc(subject_total))
```

```{r}
kable(jeop_school_summary_after) %>% 
  add_header_above(header = c(" " = 1, "After November 26, 2006" = 2))%>% 
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  row_spec(1, bold = TRUE, color = "blue") %>% 
  row_spec(3, bold = TRUE, color = "red")
```
```{r}
kable(jeop_school_summary_before) %>% 
  add_header_above(header = c(" " = 1, "Before November 26, 2006" = 2))%>% 
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  row_spec(1, bold = TRUE, color = "blue") %>% 
  row_spec(3, bold = TRUE, color = "red")

```


# Plots 1-3
## Interactive heat maps
_______________________________________________________________________________

Background info (Jeopardy show structure)
- round 1: 200 400 600 800 1000 (different for older years)
- round 2: 400 800 1200 1600 2000 (different for older years)
- round 3: wagers /final jeopardy (don't use)
- extra: daily doubles (round 1 and 2; separate plot)

first: exclude daily doubles for each round (people wager more if it is an easier subject)
_______________________________________________________________________________

### Round 1
```{r}
# data for round 1
heat_data_r1 <- jeop_school_joined %>%
  dplyr::filter(daily_double %in% "no",
                round == 1) %>% 
  dplyr::select(round, value, subject, air_date_type) %>%
  dplyr::mutate_at(vars(round, value, subject, air_date_type), 
                   funs(factor(.))) %>% 
  dplyr::group_by(round, value, subject, air_date_type) %>%
  count() %>%
  ungroup()

heat_data_r1 %>% 
  slice(1:5)
```


```{r}
# interactive version of heat map for round 1
hmap_1_interact <- ggplot(heat_data_r1,
                          aes(x = subject, y = value)) +
  geom_tile(aes(fill = n)) +
  scale_fill_viridis(option = "viridis", direction = -1) +
  labs(x = "Subject", y = "Value", 
       fill = "Number of \noccurences",
       title = "Round 1: Number of occurences of subject by value") +
  theme_light() +
  theme(axis.text.x = element_text(angle = 45)) +
  facet_grid( . ~ air_date_type, scales = "free_y")
  
hmap_1_interact <- ggplotly(hmap_1_interact)
```


### Round 2
```{r}
# data for round 2
heat_data_r2 <- jeop_school_joined %>%
  dplyr::filter(daily_double %in% "no",
                round == 2) %>% 
  dplyr::select(round, value, subject, air_date_type) %>%
  dplyr::mutate_at(vars(round, value, subject, air_date_type), 
                   funs(factor(.))) %>% 
  dplyr::group_by(round, value, subject, air_date_type) %>%
  count() %>%
  ungroup()

heat_data_r2 %>% 
  slice(1:5)
```

```{r}
# interactive version of heat map for round 2
hmap_2_interact <- ggplot(heat_data_r2, 
                          aes(x = subject, y = value)) +
  geom_tile(aes(fill = n)) +
  scale_fill_viridis(option = "magma", direction = -1) +
  labs(x = "Subject", y = "Value", 
       fill = "Number of \noccurences",
       title = "Round 2: Number of occurences of subject by value") +
  theme_light() +
  theme(axis.text.x = element_text(angle = 45)) +
  facet_grid( . ~ air_date_type, scales = "free")
  
ggplotly(hmap_2_interact)
```

### Daily Doubles
```{r}
# data for daily doubles
heat_data_dd <- jeop_school_joined %>%
  dplyr::filter(daily_double %in% "yes") %>% 
  dplyr::select(daily_double, value, subject) %>%
  dplyr::mutate_at(vars(daily_double, value, subject), funs(factor(.))) %>% 
  dplyr::group_by(daily_double, value, subject) %>%
  count() %>%
  ungroup()

heat_data_dd %>% 
  slice(1:5)
```

```{r}
# interactive version of heat map for daily doubles
hmap_dd_interact <- ggplot(heat_data_dd,
                          aes(x = subject, y = value)) +
  geom_tile(aes(fill = n)) +
  scale_fill_viridis(option = "cividis", direction = -1) +
  labs(x = "Subject", y = "Value",
       fill = "Number of \noccurences",
       title = "Daily Doubles: Number of occurences of subject by value") +
  theme_light() +
  theme(axis.text.x = element_text(angle = 45))

ggplotly(hmap_dd_interact)
```

_______________________________________________________________________________

# Plot 4
## Double faceted interactive heat map
```{r}
# data for double faceting
heat_data_df <- jeop_school_joined %>%
  dplyr::filter(daily_double %in% "no",
                round != 3) %>% 
  dplyr::select(round, value, subject, air_date_type) %>%
  dplyr::mutate_at(vars(round, value, subject, air_date_type), 
                   funs(factor(.))) %>% 
  dplyr::group_by(round, value, subject, air_date_type) %>%
  count() %>%
  ungroup()

heat_data_df %>% 
  slice(1:5)
```

```{r}
# interactive version of heat map for rounds 1 and 2 faceted by date
hmap_4_interact <- ggplot(heat_data_df, 
                          aes(x = subject, y = value)) +
  geom_tile(aes(fill = n)) +
  scale_fill_viridis(option = "plasma", direction = -1) +
  labs(x = "Subject", y = "Value", 
       fill = "Number of \noccurences",
       title = "Number of occurences of subject by value") +
  theme_light() +
  theme(axis.text.x = element_text(angle = 45),
        plot.title = element_text(size = 14),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12)) +
  facet_grid(round ~ air_date_type, scales = "free_y")  
  
ggplotly(hmap_4_interact)
```


