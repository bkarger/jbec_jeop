---
title: "plots_caroline_final"
author: "Caroline Wendt"
date: "12/9/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.path = "../figs/", echo = TRUE,
                      error = FALSE, message = FALSE, warning = FALSE)
```

# Packages
```{r}
# packages for data filtering
library(readr)
library(dplyr)
library(stringr)
library(fuzzyjoin)

# package for tables
library(kableExtra)

# packages for plots
library(ggplot2)
library(viridis)
library(forcats)
library(plotly)
library(ggthemes)
```

# Filtering
```{r}
# jeopardy data
jeop_data <- read_tsv(
  file = "../data/jeopardy_clue_dataset-master/master_season1-35.tsv") %>%
  dplyr::mutate(question = stringr::str_to_lower(question)) %>%
  dplyr::mutate(question = stringr::str_remove_all(question,
                                                   "[^[:alnum:][:blank:]]"))
  
# subjects and terms data
sub_term_data <- read_csv("../data/subjects_and_terms.csv") %>%
  rename(vocab_term = Term,
      subject = Subject) %>%
  dplyr::mutate(vocab_term = 
                  stringr::str_to_lower(vocab_term)) %>%
  dplyr::mutate(vocab_term = 
                  stringr::str_remove_all(vocab_term,
                                          "[^[:alnum:][:blank:]]")) %>%
  dplyr::distinct() %>% 
  dplyr::mutate(question = vocab_term) %>% 
  dplyr::group_by(subject) %>%
  dplyr::sample_n(size = 155, replace = FALSE) %>% 
  dplyr::ungroup()
```

# Join
```{r}
jeop_school_joined <- dplyr::inner_join(x = jeop_data,
                               y = sub_term_data,
                               by = "question")
```

# Summary statistics
```{r}
jeop_school_summary <- jeop_school_joined %>% 
  dplyr::group_by(subject) %>% 
  dplyr::summarize(mean_value = mean(value),
                   sum_sub = n()) %>% 
  dplyr::ungroup()

kableExtra::kable(jeop_school_summary)
```



# Plots 1-3
## Interactive heat maps
_______________________________________________________________________________

Background info (Jeopardy show structure)
- round 1: 200 400 600 800 1000 (different for older years)
- round 2: 400 800 1200 1600 2000 (different for older years)
- round 3: wagers /final jeopardy (don't use)
- extra: daily doubles (round 1 and 2; separate plot)

first: exclude daily doubles for each round (people wager more if it is an easier subject)

_______________________________________________________________________________

### Round 1
```{r}
# data for round 1
heat_data_r1 <- jeop_school_joined %>%
  dplyr::filter(daily_double %in% "no",
                round == 1) %>% 
  dplyr::select(round, value, subject) %>%
  dplyr::mutate_at(vars(round, value, subject), funs(factor(.))) %>% 
  dplyr::group_by(round, value, subject) %>%
  count() %>%
  ungroup()

heat_data_r1 %>% 
  slice(1:5)
```


```{r}
# interactive version of heat map for round 1
hmap_1_interact <- ggplot(heat_data_r1,
                          aes(x = subject, y = value)) +
  geom_tile(aes(fill = n)) +
  scale_fill_viridis(option = "viridis", direction = -1) +
  labs(x = "Subject", y = "Value", 
       fill = "Number of \noccurences",
       title = "Round 1: Number of occurences of subject by value") +
  theme_light()
  
ggplotly(hmap_1_interact)
```


### Round 2
```{r}
# data for round 2
heat_data_r2 <- jeop_school_joined %>%
  dplyr::filter(daily_double %in% "no",
                round == 2) %>% 
  dplyr::select(round, value, subject) %>%
  dplyr::mutate_at(vars(round, value, subject), funs(factor(.))) %>% 
  dplyr::group_by(round, value, subject) %>%
  count() %>%
  ungroup()

heat_data_r2 %>% 
  slice(1:5)
```

```{r}
# interactive version of heat map for round 2
hmap_2_interact <- ggplot(heat_data_r2, 
                          aes(x = subject, y = value)) +
  geom_tile(aes(fill = n)) +
  scale_fill_viridis(option = "magma", direction = -1) +
  labs(x = "Subject", y = "Value", 
       fill = "Number of \noccurences",
       title = "Round 2: Number of occurences of subject by value") +
  theme_light()
  
ggplotly(hmap_2_interact)
```

### Daily Doubles
```{r}
# data for daily doubles
heat_data_dd <- jeop_school_joined %>%
  dplyr::filter(daily_double %in% "yes") %>% 
  dplyr::select(daily_double, value, subject) %>%
  dplyr::mutate_at(vars(daily_double, value, subject), funs(factor(.))) %>% 
  dplyr::group_by(daily_double, value, subject) %>%
  count() %>%
  ungroup()

heat_data_dd %>% 
  slice(1:5)
```

```{r}
# interactive version of heat map for daily doubles
hmap_dd_interact <- ggplot(heat_data_dd, 
                          aes(x = subject, y = value)) +
  geom_tile(aes(fill = n)) +
  scale_fill_viridis(option = "plasma", direction = -1) +
  labs(x = "Subject", y = "Value", 
       fill = "Number of \noccurences",
       title = "Daily Doubles: Number of occurences of subject by value") +
  theme_light()
  
ggplotly(hmap_dd_interact)
```


_______________________________________________________________________________

# Plot 4
## Faceted interactive heat map
